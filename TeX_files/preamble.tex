\usepackage[outer=6cm, inner=3cm]{geometry}
\usepackage{fontspec}
\usepackage{xeCJK}

\usepackage[en-US]{datetime2}

\usepackage{fancyhdr}
\usepackage{parskip}
\usepackage{marginfix}
\usepackage{changepage}
\usepackage{enumitem}
\usepackage{booktabs}

\usepackage{xcolor}
\usepackage{soul}

\usepackage[nostandards]{baabbrevs}
\usepackage[nostdabbrevs, 2level, columns]{baarux}
\usepackage{tikzvowel, phonrule}

\usepackage[hidelinks]{hyperref}
\usepackage{cleveref}

%? References
\crefname{exesi}{}{}
\creflabelformat{exesi}{#2(#1)#3}
\crefname{exesii}{}{}
\creflabelformat{exesii}{#2(#1)#3}
\crefname{exesiii}{}{}
\creflabelformat{exesiii}{#2(#1)#3}
\crefname{exesiv}{}{}
\creflabelformat{exesiv}{#2(#1)#3}
\crefname{fnexesi}{}{}
\creflabelformat{fnexesi}{#2(#1)#3}


%? Ling stuff
% \baaruset{tr.markup=\transtext, preamble.markup=\bfseries}
% \newbaarulinetype{preamble}{pronunciation}{\phontext}
% \newbaarulinetype{tr}{lit}{\textit{Lit: }}
% \newcommand{\baaruref}[1]{\hyperref[#1]{(\ref*{#1})}}

% \addbaaruhook{everyexesi}{\setlength{\topsep}{0pt}\footnotesize}

% \newbaarulinetype{insert}{tikz}{\tikz[baaru]}
% \tikzset{baaru/.style={baseline=0.3ex}}

%? Date handling
\DTMsavedate{startdate}{2020-03-15}

%? Layout
\setcounter{secnumdepth}{1}

%* Header/footer
\setlength{\headheight}{15pt}
\pagestyle{fancy}

\fancyhf{}
\renewcommand{\headrulewidth}{.4pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[LE,RO]{\thepage}
\fancyhead[LE]{\thechapter .\hskip1em\nouppercase{\textsc{\leftmark}}}
\fancyhead[RO]{\thesection .\hskip1em\nouppercase{\rightmark}}

\fancypagestyle{plain}{
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

%* Font
\setmainfont{LibertinusSerif}[
Extension = .otf,
UprightFont = *-Regular,
BoldFont = *-Bold,
ItalicFont = *-Italic,
BoldItalicFont = *-BoldItalic,
]
\setCJKmainfont{Noto Serif CJK JP}

%* Margin notes
\setlength{\marginparsep}{2em}
\setlength{\marginparpush}{1em}
\newcommand{\aside}[1]{\marginpar{\strictpagecheck\checkoddpage \ifoddpage\raggedright \else \raggedleft\fi \footnotesize #1}}

%* Lists
\newlength{\listsep}
\setlength{\listsep}{-\parskip}
\addtolength{\listsep}{.5em}

\setlist{topsep=0em, itemsep=\listsep}
\setlist[itemize]{label=---}

%? Text formatting
\definecolor{highlight}{HTML}{A8236E}

\newcommand{\native}[1]{\textbf{#1}}
\newcommand{\nativeparen}[1]{(\thinspace #1\thinspace)}
\newcommand{\rom}[1]{\textit{#1}}
\newcommand{\trans}[1]{`#1'}
\newcommand{\detail}[1]{\textit{#1}}
\newcommand{\highlight}[1]{{\color{highlight}#1}}

%? Shortcuts
\newcommand{\langname}{Ahale}
\newcommand{\allo}{\textasciitilde}

%* Ling notation
\newcommand{\phontext}[1]{[#1]}
\newcommand{\phomtext}[1]{/#1/}
\newcommand{\morphtext}[1]{|#1|}
\newcommand{\orthotext}[1]{⟨#1⟩}

%* Revision
\makeatletter
\newcommand{\ifdraft}[2][]{\ifdim\overfullrule>\z@
  \expandafter#2\else\expandafter#1\fi}
\makeatother

\newcommand{\notetoself}[1]{\ifdraft{\aside{{\color{gray}#1}}}}
\newcommand{\add}[2][]{\ifdraft[\leavevmode\unskip]{{\color{blue}#2}\aside{{\color{blue}#1}}}}
\newcommand{\remove}[2][]{\ifdraft[#2]{{\setstcolor{red}\st{#2}}\aside{{\color{red}#1}}}}
\newcommand{\replace}[3][]{{\ifdraft[#2]{\setstcolor{red}\st{#2}}\add[#1]{#3}}}

%? Baarux stuff
\newbaarulinetype{script}{romanization}{}
\newbaarucolstyle*{mutations}{{},\textrightarrow\hspace{\baaruuse{cellspacing}}}